# Requirements: SKILL.md 模板库

## 文档联动

- requirements: `.kiro/specs/skill-templates/requirements.md`
- design: `.kiro/specs/skill-templates/design.md`
- tasks: `.kiro/specs/skill-templates/tasks.md`
- status source: `.kiro/specs/SPEC_TASKS_SCAN.md`


> **目标**：提供可复用的 SKILL.md 模板集合，降低业务接入成本  
> **优先级**：P1  
> **预估工作量**：2-3 天

---

## 1. 背景与动机

### 1.1 当前问题

开发者在创建 SKILL.md 文件时面临以下问题：
1. **学习成本高**：需要理解 Agent Skills 规范的所有细节
2. **重复劳动**：相似场景的 SKILL.md 需要重复编写
3. **质量不一致**：缺少统一的结构和最佳实践指导
4. **验证困难**：手写的 SKILL.md 容易出现格式错误

### 1.2 设计目标

建立统一的 SKILL.md 模板库，提供：
1. **分类模板**：按使用场景分类的模板集合
2. **快速生成**：通过 CLI 工具快速生成 SKILL.md
3. **自动验证**：确保生成的文件符合规范
4. **可扩展性**：支持添加自定义模板

---

## 2. 用户故事

### 2.1 作为平台开发者

**故事 1**：快速创建监控类 Skill
```
作为平台开发者
我希望能通过模板快速创建健康检查监控的 SKILL.md
这样我可以在 5 分钟内完成一个标准的监控 Skill
```

**验收标准**：
- [ ] 执行 `owlclaw skill init` 可以选择监控类模板
- [ ] 填写必要参数后自动生成完整的 SKILL.md
- [ ] 生成的文件通过 `owlclaw skill validate` 验证

**故事 2**：搜索合适的模板
```
作为平台开发者
我希望能搜索和浏览可用的模板
这样我可以找到最适合我需求的模板
```

**验收标准**：
- [ ] 可以按类别列出所有模板
- [ ] 可以通过关键词搜索模板
- [ ] 可以查看模板的详细说明和示例

**故事 3**：验证生成的文件
```
作为平台开发者
我希望生成的 SKILL.md 自动符合规范
这样我可以避免手动检查和修复格式错误
```

**验收标准**：
- [ ] 生成的文件包含所有必需字段
- [ ] frontmatter 格式正确（YAML）
- [ ] name 字段符合 kebab-case 格式
- [ ] trigger 语法正确

---

## 3. 功能需求

### 3.1 模板管理（FR-1）

#### FR-1.1：模板注册与加载

**需求**：系统能够自动发现和加载模板目录中的所有模板文件。

**验收标准**：
- [ ] 支持从 `owlclaw/templates/skills/` 目录加载模板
- [ ] 每个模板有唯一的 ID（格式：`category/template-name`）
- [ ] 加载失败的模板不影响其他模板的使用
- [ ] 提供模板列表 API

#### FR-1.2：模板元数据

**需求**：每个模板包含完整的元数据，用于展示和搜索。

**验收标准**：
- [ ] 元数据包含：name、description、category、tags、parameters
- [ ] 元数据存储在模板文件的注释块中（Jinja2 注释格式）
- [ ] 元数据格式为 YAML
- [ ] 支持解析和验证元数据

#### FR-1.3：模板分类

**需求**：模板按使用场景分类，便于查找。

**验收标准**：
- [ ] 支持 5 个预定义类别：monitoring、analysis、workflow、integration、report
- [ ] 每个类别有独立的目录
- [ ] 可以按类别过滤模板列表
- [ ] 类别信息在模板元数据中明确标注

#### FR-1.4：模板参数定义

**需求**：模板定义清晰的参数列表，指导用户填写。

**验收标准**：
- [ ] 参数包含：name、type、description、required、default、choices
- [ ] 支持的参数类型：str、int、bool、list
- [ ] 必需参数和可选参数明确区分
- [ ] 参数有默认值时自动应用

### 3.2 模板渲染（FR-2）

#### FR-2.1：Jinja2 模板渲染

**需求**：使用 Jinja2 引擎渲染模板，生成 SKILL.md 文件。

**验收标准**：
- [ ] 支持 Jinja2 语法（变量、条件、循环）
- [ ] 支持自定义过滤器（kebab_case、snake_case）
- [ ] 渲染结果确定性（相同输入产生相同输出）
- [ ] 处理模板语法错误并给出明确提示

#### FR-2.2：参数验证

**需求**：渲染前验证参数的完整性和正确性。

**验收标准**：
- [ ] 检查所有必需参数是否提供
- [ ] 验证参数类型是否匹配
- [ ] 验证参数值是否在 choices 范围内
- [ ] 参数验证失败时给出明确的错误信息

#### FR-2.3：默认值处理

**需求**：自动应用参数的默认值。

**验收标准**：
- [ ] 未提供值的可选参数使用默认值
- [ ] 默认值在渲染时自动填充
- [ ] 支持复杂类型的默认值（如 list）

### 3.3 文件验证（FR-3）

#### FR-3.1：Frontmatter 验证

**需求**：验证生成的 SKILL.md 文件的 frontmatter 部分。

**验收标准**：
- [ ] frontmatter 是有效的 YAML 格式
- [ ] 包含必需字段：name、description
- [ ] name 字段符合 kebab-case 格式
- [ ] 验证 owlclaw 扩展字段（如果存在）

#### FR-3.2：Trigger 语法验证

**需求**：验证 trigger 字段的语法正确性。

**验收标准**：
- [ ] 支持 cron 格式：`cron("* * * * *")`
- [ ] 支持 webhook 格式：`webhook("/path")`
- [ ] 支持 queue 格式：`queue("queue-name")`
- [ ] 不支持的格式给出明确错误

#### FR-3.3：Body 验证

**需求**：验证 Markdown body 部分的基本结构。

**验收标准**：
- [ ] body 不为空
- [ ] 至少包含一个标题
- [ ] 没有未替换的 Jinja2 占位符

### 3.4 模板搜索（FR-4）

#### FR-4.1：关键词搜索

**需求**：支持通过关键词搜索模板。

**验收标准**：
- [ ] 搜索范围：name、description、tags
- [ ] 搜索不区分大小写
- [ ] 返回结果按相关性排序
- [ ] 支持部分匹配

#### FR-4.2：类别过滤

**需求**：支持按类别过滤模板。

**验收标准**：
- [ ] 可以指定单个类别
- [ ] 返回该类别下的所有模板
- [ ] 与关键词搜索可以组合使用

#### FR-4.3：标签过滤

**需求**：支持按标签过滤模板。

**验收标准**：
- [ ] 可以指定一个或多个标签
- [ ] 返回包含任一标签的模板
- [ ] 与类别过滤可以组合使用

---

## 4. 非功能需求

### 4.1 可靠性（NFR-1）

**需求**：模板库在各种环境下稳定可用。

**验收标准**：
- [ ] 模板加载失败不影响系统其他功能
- [ ] 单个模板错误不影响其他模板
- [ ] 提供详细的错误日志
- [ ] 在本地和 CI 环境中稳定运行

### 4.2 可维护性（NFR-2）

**需求**：模板库易于维护和扩展。

**验收标准**：
- [ ] 添加新模板无需修改代码
- [ ] 模板文件结构清晰
- [ ] 提供模板开发指南
- [ ] 代码有清晰的文档和注释

### 4.3 性能（NFR-3）

**需求**：模板操作响应迅速。

**验收标准**：
- [ ] 加载所有模板 < 1 秒
- [ ] 渲染单个模板 < 100ms
- [ ] 搜索模板 < 200ms
- [ ] 验证文件 < 500ms

### 4.4 可用性（NFR-4）

**需求**：CLI 工具易于使用。

**验收标准**：
- [ ] 提供交互式向导
- [ ] 错误信息清晰易懂
- [ ] 提供使用示例和帮助文档
- [ ] 支持非交互模式（用于自动化）

---

## 5. 验收标准总览

### 5.1 功能验收

**模板管理**：
- [ ] FR-1.1：模板注册与加载
- [ ] FR-1.2：模板元数据
- [ ] FR-1.3：模板分类
- [ ] FR-1.4：模板参数定义

**模板渲染**：
- [ ] FR-2.1：Jinja2 模板渲染
- [ ] FR-2.2：参数验证
- [ ] FR-2.3：默认值处理

**文件验证**：
- [ ] FR-3.1：Frontmatter 验证
- [ ] FR-3.2：Trigger 语法验证
- [ ] FR-3.3：Body 验证

**模板搜索**：
- [ ] FR-4.1：关键词搜索
- [ ] FR-4.2：类别过滤
- [ ] FR-4.3：标签过滤

### 5.2 非功能验收
- [ ] NFR-1：可靠性
- [ ] NFR-2：可维护性
- [ ] NFR-3：性能
- [ ] NFR-4：可用性

### 5.3 测试验收
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试覆盖核心场景
- [ ] 提供至少 3 个完整的模板示例
- [ ] CLI 工具端到端测试通过

---

## 6. 约束与假设

### 6.1 约束
- 使用 Jinja2 作为模板引擎（已是项目依赖）
- 使用 YAML 作为元数据格式
- 遵循 Agent Skills 规范
- 不引入新的外部依赖
- 兼容现有的 OwlClaw CLI 架构

### 6.2 假设
- 开发者熟悉基本的 YAML 和 Markdown 语法
- 开发者了解 Agent Skills 的基本概念
- Python 3.10+ 环境可用
- 文件系统可读写

---

## 7. 依赖

### 7.1 外部依赖
- **Agent Skills 规范**：定义 SKILL.md 的格式标准
- **Jinja2**：模板渲染引擎
- **PyYAML**：YAML 解析

### 7.2 内部依赖
- **owlclaw.cli**：CLI 框架
- **owlclaw.capabilities.skills**：Skills 加载器
- **现有的配置管理机制**

---

## 8. 风险与缓解

### 8.1 风险：模板质量不一致

**影响**：不同模板的质量和风格差异大，影响用户体验。

**缓解**：
- 建立模板开发规范
- 提供模板审查清单
- 所有模板经过验证测试

### 8.2 风险：Agent Skills 规范变更

**影响**：规范变更可能导致现有模板失效。

**缓解**：
- 在模板元数据中记录规范版本
- 提供模板迁移工具
- 建立自动化验证流程

### 8.3 风险：用户误用模板

**影响**：用户可能不理解模板参数，生成不符合预期的文件。

**缓解**：
- 提供详细的参数说明
- 在 CLI 中提供参数验证和提示
- 提供使用示例和最佳实践文档

---

## 9. Definition of Done（DoD）

### 9.1 能力交付
- [ ] 实现 TemplateRegistry、TemplateRenderer、TemplateValidator、TemplateSearcher 四个核心组件
- [ ] 提供至少 3 个类别、每个类别 2 个模板（共 6 个模板）
- [ ] 实现 `owlclaw skill init` CLI 命令
- [ ] 实现 `owlclaw skill validate` CLI 命令
- [ ] 实现 `owlclaw skill list` CLI 命令

### 9.2 文档交付
- [ ] 模板开发指南
- [ ] CLI 使用文档
- [ ] API 文档（组件接口）
- [ ] 至少 3 个完整的使用示例

### 9.3 验证与质量
- [ ] 所有功能需求的验收标准通过
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试覆盖核心场景
- [ ] 在本地和 CI 环境中稳定运行
- [ ] 代码通过 lint 和 type check

### 9.4 可演示
- [ ] 可以演示从零创建一个监控类 Skill（< 5 分钟）
- [ ] 可以演示搜索和浏览模板
- [ ] 可以演示验证生成的文件

---

## 10. 参考文档

- **Agent Skills 规范**：定义 SKILL.md 格式
- **docs/ARCHITECTURE_ANALYSIS.md**：OwlClaw 架构分析
- **Jinja2 文档**：https://jinja.palletsprojects.com/
- **现有 Skills 示例**：`capabilities/` 目录

---

**维护者**：平台研发  
**最后更新**：2026-02-22
