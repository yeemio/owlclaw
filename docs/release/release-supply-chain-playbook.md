# Release Supply Chain Playbook

Last updated: 2026-02-26

## Scope

This playbook defines thresholds, acceptance matrix, and T+0~T+15 response flow for release supply chain operations.

## Thresholds

1. TestPyPI publish success rate target: >= 99% (last 20 runs)
2. Publish-to-install smoke total time target: <= 5 minutes
3. Provenance/attestation archive completeness: 100%

## Acceptance Matrix

| Scenario | Check | Evidence | Pass |
|---|---|---|---|
| TestPyPI publish | OIDC publishing flow executes | Workflow logs | [ ] |
| PyPI publish | Package install smoke passes | Smoke logs | [ ] |
| Provenance | Attestation is generated and archived | Attestation artifact | [ ] |
| Failure rollback | Rollback path is executable | Drill logs | [ ] |

## Current Evidence Snapshot

Source of truth reports:
- `docs/release/release-supply-chain-audit.json` (generated by `scripts/ops/release_supply_chain_audit.py`)
- `docs/release/release-policy-audit.json`

1. Run `22446541468` (main, 2026-02-26) failed at TestPyPI upload with `HTTP 403` and empty `TWINE_PASSWORD`.
2. This confirms main branch still follows legacy token-based publishing path.
3. Runs `22449095206` and `22449361552` (`codex-gpt-work`, 2026-02-26) executed OIDC publishing and failed with `invalid-publisher`.
4. Run `22449361552` confirms normalized claim: `sub=repo:yeemio/owlclaw:environment:pypi-release`, `environment=pypi-release`.
5. Remaining blocker is external Trusted Publisher mapping on PyPI/TestPyPI.

## Trusted Publisher Mapping Template

Configure both TestPyPI and PyPI with the same publisher mapping:

1. Owner: `yeemio`
2. Repository: `owlclaw`
3. Workflow: `.github/workflows/release.yml`
4. Environment: `pypi-release`
5. Trigger branch for verification: `codex-gpt-work` first, then `main`

## T+0 to T+15 Response Script

1. T+0: Release failure detected; block downstream publish steps.
2. T+3: Identify failure stage (OIDC auth, upload, smoke, provenance).
3. T+6: Replay in TestPyPI and verify platform configuration.
4. T+10: Execute rollback or retry decision.
5. T+15: Publish status update and remediation plan.
