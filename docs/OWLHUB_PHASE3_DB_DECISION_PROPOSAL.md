# OwlHub Phase 3 数据库化决策提案（待评审）

> 状态：`Proposed`  
> 日期：`2026-02-25`  
> 目标：解决 `.kiro/specs/owlhub/tasks.md` Task 19（数据库基础设施）与当前实现路径的范围冲突

---

## 1. 背景

当前 OwlHub 在仓内已具备：

1. API 路由、审核流、统计流、发布闸门与部署脚本。
2. 文件后端模式可用于本地/预发验证。
3. Release Gate 已提供生产发布前检查入口。

但 spec 中 Task 19 明确要求数据库迁移与 ORM 落地，而仓内尚未落地对应 `migrations/versions` 与 `owlclaw/owlhub/models`（除 blacklist 外）的完整实现，形成 `40/42` 卡点。

---

## 2. 问题定义

需要明确 OwlHub Phase 3 的交付边界：

1. 是否在当前发布窗口内强制完成 DB 化（Task 19）？
2. 若不强制，是否允许将 Task 19 作为“架构决策阻塞项”并以文件后端先发布？
3. 发布闸门（40.4）是否要求 DB 化完成后才允许生产部署？

---

## 3. 选项

### 方案 A：立即完整 DB 化（一次性收口 Task 19）

1. 实现 Alembic 迁移 + 完整 ORM 模型 + 对应测试。
2. 所有 API/统计/审核流切换到 DB 主路径。
3. 再执行生产部署。

优点：spec 一次收口，技术债最小。  
代价：发布节奏明显延后，当前窗口风险高。

### 方案 B：分阶段 DB 化（推荐）

1. 当前发布窗口保留文件后端作为 GA/灰度路径。
2. 将 Task 19 拆成独立里程碑（Phase 3.1 DB Core）。
3. 明确“DB 化完成”作为后续生产规模化前置门槛。

优点：兼顾发布节奏与架构正确性。  
代价：短期存在双后端并行成本。

### 方案 C：长期维持文件后端，不做 DB 化

优点：实现成本最低。  
风险：与现有 spec 和后续规模化目标冲突，不建议。

---

## 4. 推荐决策

建议采用 **方案 B（分阶段 DB 化）**：

1. 维持当前 `owlhub 40/42` 状态，不虚假勾选 Task 19/40.4。
2. 由决策组确认 DB 化拆分里程碑与验收门槛。
3. 在 `release` 阶段先完成可本地验证项与外部平台动作，DB 化作为后续强制里程碑推进。

---

## 5. 决策后执行清单

1. 新建 `owlhub-db-core` 子 spec（或在 owlhub 下新增 Phase 3.1 专章）。
2. 明确最小落地范围：
   - `skills/versions/statistics/reviews` 四表迁移；
   - 对应 SQLAlchemy 模型；
   - 关键读写路径切换与回归测试。
3. 在 `SPEC_TASKS_SCAN` 与 `owlhub/tasks.md` 统一更新阻塞说明和里程碑日期。

---

## 6. 需决策组回答

1. DB 化是否作为 `v0.1.x` 强制项，还是 `v0.2.0` 强制项？
2. 文件后端在生产是否只允许只读/小规模使用？
3. 40.4 生产部署是否允许“文件后端先行 + DB 化后迁移”？

---

## 7. 当前建议（执行口径）

在未决策前，维持现状：

1. `owlhub` 保持 `40/42`，标注“架构决策阻塞”。
2. `release` 按可执行项持续推进，不等待 DB 化。
3. 决策通过后再开启 Task 19 实施分支。
